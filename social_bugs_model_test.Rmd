---
title: "social_bugs_model_test"
output: html_document
date: "2024-09-11"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown


```{r data}
"C1" <-
structure(c(1,1,1,1,1,2,2,2,2,2,1,1,1,1,1,2,2,2,2,2,1,1,1,1,1,2,2,2,2,2,1,1,1,1,1,2,2,2,2,2,1,1,1,1,1,2,2,2,2,2,1,1,1,1,1,2,2,2,2,2,1,1,1,1,1,2,2,2,2,2,1,1,1,1,1,2,2,2,2,2,1,1,1,1,1,2,2,2,2,2,1,1,1,1,1,2,2,2,2,2,1,1,1,1,1,2,2,2,2,2,1,1,1,1,1,2,2,2,2,2,1,1,1,1,1,2,2,2,2,2,1,1,1,1,1,2,2,2,2,2,1,1,1,1,1,2,2,2,2,2,1,1,1,1,1,2,2,2,2,2,1,1,1,1,1,2,2,2,2,2,1,1,1,1,1,2,2,2,2,2,1,1,1,1,1,2,2,2,2,2,1,1,1,1,1,2,2,2,2,2), .Dim=c(5,40))
"nC1" <-
2
"NS" <-
5
"G" <-
c(40, 40, 40, 40, 40)
"T" <-
4
"dI" <-
structure(c(-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,1,1,1,1,-1,-1,-1,-1,-1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,-1,-1,-1,-1,-1,1,1,1,1,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,1,1,1,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,1,1,1,1,1,1,1,1,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,1,1,1,1,-1,-1,-1,-1,-1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,-1,-1,-1,-1,-1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,-1,-1,-1,-1,-1,1,1,1,1,1), .Dim=c(5,40))
"a" <-
structure(c(2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,2,2,2,2,2,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,2,2,2,2,2,1,1,1,1,1,2,2,2,2,2,1,1,1,1,1,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,2,2,2,2,2,1,1,1,1,1,2,2,2,2,2,1,1,1,1,1,2,2,2,2,2,1,1,1,1,1,2,2,2,2,2,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,2,2,2,2,2,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1), .Dim=c(5,40,4))
"c5" <-
structure(c(0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,0,1,0,1,0,1,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,1,1,1,1,1,1,1,0,0,0,0,0,1,1,1,1,1,1,1,1,0,1,1,0,1,1,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,1,1,1,1,1,0,0,0,0,0,1,1,1,0,1,0,1,0,1,1,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,0,0,1,0,0,0,0,0,0,1,1,1,1,1,0,1,1,1,1,1,0,0,1,1,1,1,1,1,1,0,0,1,0,1,0,0,0,0,0,1,1,1,1,1), .Dim=c(5,40))
"r" <-
structure(c(48,48,48,48,48,38,38,38,38,38,47,47,47,47,47,53,53,53,53,53,34,34,34,34,34,67,67,67,67,67,48,48,48,48,48,71,71,71,71,71,67,67,67,67,67,33,33,33,33,33,64,64,64,64,64,51,51,51,51,51,46,46,46,46,46,66,66,66,66,66,31,31,31,31,31,57,57,57,57,57,68,68,68,68,68,62,62,62,62,62,43,43,43,43,43,40,40,40,40,40,67,67,67,67,67,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,47,47,47,47,47,68,68,68,68,68,68,68,68,68,68,67,67,67,67,67,56,56,56,56,56,59,59,59,59,59,48,48,48,48,48,46,46,46,46,46,72,72,72,72,72,39,39,39,39,39,47,47,47,47,47,60,60,60,60,60,48,48,48,48,48,50,50,50,50,50,43,43,43,43,43,54,54,54,54,54,42,42,42,42,42,25,25,25,25,25,36,36,36,36,36,47,47,47,47,47,50,50,50,50,50,58,58,58,58,58,32,32,32,32,32,59,59,59,59,59,61,61,61,61,61,44,44,44,44,44,59,59,59,59,59,42,42,42,42,42,62,62,62,62,62,50,50,50,50,50,25,25,25,25,25,51,51,51,51,51,62,62,62,62,62,49,49,49,49,49,32,32,32,32,32,44,44,44,44,44,68,68,68,68,68,63,63,63,63,63,55,55,55,55,55,62,62,62,62,62,41,41,41,41,41,57,57,57,57,57,52,52,52,52,52,61,61,61,61,61,43,43,43,43,43,53,53,53,53,53,43,43,43,43,43,62,62,62,62,62,63,63,63,63,63,33,33,33,33,33,35,35,35,35,35,49,49,49,49,49,39,39,39,39,39,34,34,34,34,34,39,39,39,39,39,70,70,70,70,70,33,33,33,33,33,41,41,41,41,41,49,49,49,49,49,38,38,38,38,38,53,53,53,53,53,52,52,52,52,52,40,40,40,40,40,56,56,56,56,56,60,60,60,60,60,48,48,48,48,48,51,51,51,51,51,36,36,36,36,36,41,41,41,41,41,58,58,58,58,58,40,40,40,40,40,58,58,58,58,58,53,53,53,53,53,41,41,41,41,41,45,45,45,45,45,31,31,31,31,31,61,61,61,61,61,55,55,55,55,55,47,47,47,47,47,53,53,53,53,53,32,32,32,32,32,70,70,70,70,70,60,60,60,60,60,52,52,52,52,52,59,59,59,59,59,52,52,52,52,52,35,35,35,35,35,41,41,41,41,41,57,57,57,57,57,48,48,48,48,48,32,32,32,32,32,62,62,62,62,62,33,33,33,33,33,42,42,42,42,42,28,28,28,28,28,73,73,73,73,73,65,65,65,65,65,24,24,24,24,24,40,40,40,40,40,38,38,38,38,38,39,39,39,39,39,83,83,83,83,83,42,42,42,42,42,62,62,62,62,62,76,76,76,76,76,39,39,39,39,39,60,60,60,60,60,19,19,19,19,19,51,51,51,51,51,60,60,60,60,60,40,40,40,40,40,42,42,42,42,42,37,37,37,37,37,48,48,48,48,48,44,44,44,44,44,39,39,39,39,39,52,52,52,52,52,60,60,60,60,60,54,54,54,54,54,85,85,85,85,85,32,32,32,32,32,61,61,61,61,61,58,58,58,58,58,36,36,36,36,36,42,42,42,42,42,68,68,68,68,68,40,40,40,40,40,51,51,51,51,51,40,40,40,40,40,48,48,48,48,48,38,38,38,38,38,61,61,61,61,61,64,64,64,64,64,40,40,40,40,40,34,34,34,34,34,59,59,59,59,59,68,68,68,68,68,37,37,37,37,37,42,46,46,42,46,41,41,41,41,41,49,49,49,49,49,79,79,79,79,79,43,41,41,43,41,64,57,64,57,64,72,72,72,72,72,53,53,53,53,53,58,58,58,59,59,47,47,47,47,47,57,57,57,37,57,59,61,59,61,61,38,38,38,38,38,61,61,61,61,61,55,55,55,55,55,50,50,50,44,50,46,42,46,46,42,45,45,45,45,45,71,71,71,71,71,62,62,62,59,59,56,56,56,56,56,92,92,92,92,92,35,35,35,35,35,74,56,74,56,56,61,61,61,61,61,66,66,66,43,43,62,62,62,62,62,64,50,64,64,64,42,39,42,39,39,57,57,57,37,57,68,68,68,68,68,46,46,46,46,46,33,40,40,40,40,56,66,66,56,56,60,60,60,60,60,43,43,41,43,41,37,37,37,37,37,69,69,69,69,69), .Dim=c(5,40,5))

```

```{r model}




# priors ==============================================================
alpha_start <- numeric(NS)
alpha_inf <- numeric(NS)
mu0 <- numeric(NS)
alpha0 <- numeric(NS)
alpha_d <- numeric(NS)
AA <- matrix(0, nrow=NS, ncol=2)
SB <- matrix(0, nrow=NS, ncol=2)
BB <- matrix(0, nrow=NS, ncol=2)
alpha1 <- array(0, dim = c(NS, max(G), T + 1))
alpha2 <- array(0, dim = c(NS, max(G), T + 1))
mu1 <- array(0, dim = c(NS, max(G), T + 1))
mu2 <- array(0, dim = c(NS, max(G), T + 1))
dQ <- matrix(0, nrow=NS, ncol=max(G))
p <- matrix(0, nrow=NS, ncol=max(G))

A <- matrix(0, nrow = NS, ncol = max(G))
sigma_g <- matrix(0, nrow = NS, ncol = max(G))
bias <- matrix(0, nrow = NS, ncol = max(G))


# Assign values for subject 1
s <- 1
alpha_start[s] <- 0.6850
alpha_inf[s] <- 0.1792
mu0[s] <- 49.8909

# compute alpha0 and alpha_d
alpha0[s]  <- alpha_start[s] / (1 - alpha_start[s]) - alpha_inf[s]^2 / (1 - alpha_inf[s])
alpha_d[s] <- alpha_inf[s]^2 / (1 - alpha_inf[s])

# information bonus and decision noise ----------------------------

AA[s,1] <- 0.5021
AA[s,2] <- 0.7007
SB[s,1] <- 1.2662
SB[s,2] <- -2.3547
BB[s,1] <- 2.6655
BB[s,2] <- 3.5946



# subject level =======================================================
for (s in 1:NS) { # loop over subjects
    for (g in 1:G[s]) { # loop over games
        
        # inference model ---------------------------------------------
        
        # initialize stuff
        # learning rates 
        alpha1[s,g,1] <- alpha0[s]
        alpha2[s,g,1] <- alpha0[s]

        # values
        mu1[s,g,1] <- mu0[s]
        mu2[s,g,1] <- mu0[s]

        # information bonus and decision noise for this game depend on 
        # condition 1, C1, and condition 2, C2
        A[s,g] <- AA[s, C1[s,g]]
        sigma_g[s,g] <- BB[s, C1[s,g]]
        bias[s,g] <- SB[s, C1[s,g]]


        # run inference model
        for (t in 1:T) { # loop over forced-choice trials

            # learning rates
            alpha1[s,g,t+1] <- ifelse( a[s,g,t] == 1, 1/( 1/(alpha1[s,g,t] + alpha_d[s]) + 1 ), 1/( 1/(alpha1[s,g,t] + alpha_d[s]) ) )
            alpha2[s,g,t+1] <- ifelse( a[s,g,t] == 2, 1/( 1/(alpha2[s,g,t] + alpha_d[s]) + 1 ), 1/( 1/(alpha2[s,g,t] + alpha_d[s]) ) )

            # update means for each bandit
            mu1[s,g,t+1] <- ifelse( a[s,g,t] == 1, mu1[s,g,t] + alpha1[s,g,t+1] * (r[s,g,t] - mu1[s,g,t]), mu1[s,g,t])
            mu2[s,g,t+1] <- ifelse( a[s,g,t] == 2, mu2[s,g,t] + alpha2[s,g,t+1] * (r[s,g,t] - mu2[s,g,t]), mu2[s,g,t])

        }

        # compute difference in values
        dQ[s,g] <- mu2[s,g,T+1] - mu1[s,g,T+1] + A[s,g] * dI[s,g] + bias[s,g]

        # choice probabilities
        p[s,g] <- 1 / ( 1 + exp( - dQ[s,g] / (sigma_g[s,g])))

    }
}



    




```

